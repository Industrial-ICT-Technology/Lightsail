

{% extends 'base.html' %}
 {% load static %} {% block style %}
<link rel="stylesheet" href="{% static 'mainapp/css/statusCount.css' %}?after" />
{% endblock %}
{% block content-title %}
<h2 class="content-title fs-large fw-600 gray-200">
    Work Status
</h2>    
{% endblock %}
{% block content %}
<div class="first-desc primary-bg gray-100">
  <div class="first-desc-wrap">
    
      <div class="pop_top">

        <form style="display: inline-block" action="" method="get" class="first" name="afgsgd">
          {% csrf_token %}
          <div class="subject">제품 선택</div>
          
          <select name="category_product" id="product_select">
              {% for product_name in product_names %}
                  <option value="{{ product_name }}"
                      {% if category_product == product_name %} selected {% endif %}>
                      {{ product_name }}
                  </option>
              {% endfor %}
          </select>
          <button id="myBtn">작업자별 진행 현황</button>
      </form>


          
          <script> // 제품 선택 후 로컬에 저장
            document.addEventListener("DOMContentLoaded", function() {
              var select = document.getElementById("product_select");
              var storedValue = localStorage.getItem("product_select");
              if (storedValue) {
                select.value = storedValue;
              }
              select.addEventListener("change", function() {
                localStorage.setItem("product_select", this.value);
              });
            });
          
            $(document).ready(function() {
              $('#product_select').change(function() {
                $('form[name="afgsgd"]').submit();
              });
            });
          </script>
        
       
        <div class="count_table">
          <table>
            <thead>
              <tr>
                <th style="width:250px">ID</th>
                <th style="width:190px">개수</th>
                <th style="width:150px">비고</th>
              </tr>
            </thead>
            <tbody>
              {% if result_list %}
              {% for name, count in result_list %}
              <tr>
                <td style="width:250px">{{ name }} </td>
                <td style="width:190px">{{ count }}</td>
                <td style="width:150px">-</td>
              </tr>
              
              {% endfor %}
              {% endif %}
            <tbody>

          </table>    
      </div>
    </div>  
    </div>
  </div>
 
  <!-- 팝업창을 위한 HTML 코드 -->
  <div id="myModal" class="popup">
    <div class="popup-content">
        <span class="close">&times;</span>
        {{ category_product }}
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
        <div id="modal-content">
            <div>
                <canvas id="myChart"></canvas>
            </div>
            <script>
                // 1. result_list를 이용하여 name과 count의 리스트를 생성합니다.
                const nameList = [];
                const countList = [];
                {% for name, count in result_list %}
                    nameList.push("{{ name }}");
                    countList.push({{ count }});
                {% endfor %}

                // 2. 생성된 리스트를 JavaScript에서 이용할 수 있도록 JSON 형태로 바꿉니다.
                const data = {
                    labels: nameList,
                    datasets: [{
                        label: 'Count',
                        data: countList,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                };

                // 3. Chart.js를 사용하여 차트를 생성합니다.
                const ctx = document.getElementById('myChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: data,
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            </script>
        </div>
    </div>
</div>
 
 

  <script>
    $(document).ready(function(){
      $("#myBtn").click(function(e){
        e.preventDefault();
        $("#myModal").show();

      });
      $(".close").click(function(){
        $("#myModal").hide();
      });
    });
  </script>
    <style>
      .popup {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
        padding-left: 546px;
        padding-top : 147px
        
      }
      .popup-content {
        background-color: white;
        padding : 27.5px 33px 40px 33px;
        border: 1px solid #888;
         width: 598px;
        height: 529px; 
        border-radius: 5px;
      }
    .pop_subject{
      display: inline-block;
        margin-right: 15px;
        
        font-size: 16px;
        font-weight: 400;
        line-height: 24px;
        letter-spacing: 0em;
        text-align: left;
    }
    
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      .close:hover, .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }
    </style>
{% endblock %}